@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  /* Base theme colors on html to prevent white flash between page navigations */
  html {
    background-color: #f8fafc; /* slate-50 fallback for light mode */
  }

  html[data-theme='dark'],
  html.dark {
    background-color: #020617; /* slate-950 for dark mode */
  }

  /* Self-hosted Inter variable font */
  @font-face {
    font-family: 'Inter';
    src: url('/fonts/inter.woff2') format('woff2');
    font-weight: 100 900;
    font-style: normal;
    font-display: swap;
  }

  /* Self-hosted Fira Code variable font */
  @font-face {
    font-family: 'Fira Code';
    src: url('/fonts/fira-code.woff2') format('woff2');
    font-weight: 300 700;
    font-style: normal;
    font-display: swap;
  }

  /* Fallback font adjustments to minimize layout shift */
  @font-face {
    font-family: 'Inter Fallback';
    src: local('Arial');
    size-adjust: 107%;
    ascent-override: 90%;
    descent-override: 22%;
    line-gap-override: 0%;
  }

  @font-face {
    font-family: 'Fira Code Fallback';
    src: local('Courier New');
    size-adjust: 97%;
    ascent-override: 88%;
    descent-override: 22%;
    line-gap-override: 0%;
  }

  /* Custom scrollbar for better dark theme support */
  ::-webkit-scrollbar {
    @apply w-2;
  }

  ::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-dark-800;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-dark-600 rounded-full;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-dark-500;
  }

  /* Refined scrollbar for TOC */
  #toc-nav::-webkit-scrollbar {
    @apply w-1.5;
  }

  #toc-nav::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  #toc-nav::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-600 rounded-full;
  }

  #toc-nav::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-500;
  }

  /* Better focus styles */
  *:focus {
    @apply outline-none ring-2 ring-primary-500/50 ring-offset-2 ring-offset-white dark:ring-offset-dark-900;
  }

  /* Smooth scroll behavior */
  html {
    @apply scroll-smooth;
    scroll-padding-top: 6rem;
  }

  /* Typography improvements */
  body {
    @apply text-gray-700 dark:text-gray-200;
    font-feature-settings:
      'kern' 1,
      'liga' 1,
      'calt' 1;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

@layer components {
  /* Navigation styles */
  .nav-link {
    @apply relative overflow-hidden;
  }

  .nav-link::before {
    @apply absolute inset-0 bg-gradient-to-r from-primary-500/10 to-primary-600/10 translate-x-full transition-transform duration-300 ease-out;
    content: '';
  }

  .nav-link:hover::before {
    @apply translate-x-0;
  }

  /* Sidebar improvements */
  .sidebar-link {
    @apply relative;
  }

  /* Base active state - fallback */
  .sidebar-link.active {
    @apply font-semibold;
  }

  /* Section-specific active states */
  .sidebar-link.active-getting-started {
    @apply text-primary-700 dark:text-primary-300 bg-primary-100 dark:bg-primary-900/30;
  }

  .sidebar-link.active-core-concepts {
    @apply text-emerald-700 dark:text-emerald-300 bg-emerald-100 dark:bg-emerald-900/30;
  }

  .sidebar-link.active-configuration {
    @apply text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30;
  }

  .sidebar-link.active-cli {
    @apply text-purple-700 dark:text-purple-300 bg-purple-100 dark:bg-purple-900/30;
  }

  .sidebar-link.active-api {
    @apply text-red-700 dark:text-red-300 bg-red-100 dark:bg-red-900/30;
  }

  .sidebar-link.active-examples {
    @apply text-cyan-700 dark:text-cyan-300 bg-cyan-100 dark:bg-cyan-900/30;
  }

  .sidebar-link.active-advanced {
    @apply text-gray-900 dark:text-gray-100 bg-gray-200 dark:bg-gray-800/50 font-bold;
  }

  /* Enhanced prose styles */
  .prose {
    @apply text-gray-700 dark:text-gray-200 leading-relaxed;
  }

  .prose h1 {
    @apply text-4xl lg:text-5xl font-bold mb-8 mt-0 text-gray-900 dark:text-white leading-tight;
  }

  .prose h2 {
    @apply text-2xl lg:text-3xl font-bold mb-6 mt-12 text-gray-900 dark:text-white relative;
  }

  .prose h2::before {
    @apply absolute -left-4 top-1 w-1 h-8 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full;
    content: '';
  }

  .prose h3 {
    @apply text-xl lg:text-2xl font-semibold mb-4 mt-10 text-gray-900 dark:text-white;
  }

  .prose h4 {
    @apply text-lg lg:text-xl font-semibold mb-3 mt-8 text-gray-900 dark:text-white;
  }

  .prose h1 code,
  .prose h2 code,
  .prose h3 code,
  .prose h4 code {
    @apply bg-transparent px-0 py-0 text-inherit text-[0.85em] font-mono;
  }

  .prose p {
    @apply mb-6 leading-relaxed text-gray-600 dark:text-gray-300;
  }

  .prose ul,
  .prose ol {
    @apply mb-6 pl-6 space-y-2;
  }

  .prose li {
    @apply text-gray-600 dark:text-gray-300;
  }

  .prose li::marker {
    @apply text-primary-500;
  }

  .prose code {
    @apply bg-gray-100 dark:bg-dark-800 px-2.5 py-1 rounded-md text-sm font-mono text-primary-700 dark:text-primary-300 font-medium;
  }

  .prose pre {
    @apply bg-gray-50 dark:bg-dark-800 text-gray-800 dark:text-gray-100 p-6 rounded-xl overflow-x-auto mb-6 shadow-soft-lg border border-gray-200 dark:border-dark-700/50 max-w-full;
  }

  .prose pre code {
    @apply bg-transparent px-0 py-0 text-inherit rounded-none;
  }

  .prose pre code,
  .dark .prose pre code {
    background-color: transparent;
    color: inherit;
  }

  .prose blockquote {
    @apply border-l-4 border-primary-500 bg-primary-50/50 dark:bg-primary-900/20 pl-6 py-4 italic text-gray-700 dark:text-gray-300 mb-6 rounded-r-lg;
  }

  .prose table {
    @apply w-full border-collapse mb-6 bg-white dark:bg-dark-800 rounded-lg overflow-hidden shadow-soft;
  }

  .prose th,
  .prose td {
    @apply border-b border-gray-200 dark:border-dark-600 px-6 py-4 text-left;
  }

  .prose th {
    @apply bg-gray-50 dark:bg-dark-700 font-semibold text-gray-900 dark:text-white;
  }

  .prose td {
    @apply text-gray-600 dark:text-gray-300;
  }

  .prose a {
    @apply text-primary-600 dark:text-primary-400 font-medium no-underline relative;
    transition: all 0.2s ease;
  }

  .prose a::after {
    @apply absolute bottom-0 left-0 w-0 h-0.5 bg-gradient-to-r from-primary-500 to-primary-600 transition-all duration-300;
    content: '';
  }

  .prose a:hover::after {
    @apply w-full;
  }

  .prose a:hover {
    @apply text-primary-700 dark:text-primary-300;
  }

  /* Constrain prose content to prevent horizontal overflow */
  .prose {
    @apply min-w-0;
  }

  .prose table {
    @apply block overflow-x-auto;
  }

  .prose img,
  .prose video,
  .prose iframe {
    @apply max-w-full;
  }

  /* Button components */
  .btn-primary {
    @apply bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-semibold px-6 py-3 rounded-lg shadow-soft hover:shadow-glow transition-all duration-300 transform hover:scale-105;
  }

  .btn-secondary {
    @apply bg-white dark:bg-dark-800 border-2 border-primary-600 dark:border-primary-400 text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 font-semibold px-6 py-3 rounded-lg shadow-soft hover:shadow-soft-lg transition-all duration-300;
  }

  /* Card component */
  .card {
    @apply bg-white/60 dark:bg-dark-800/60 backdrop-blur-sm rounded-xl p-6 shadow-soft hover:shadow-soft-lg transition-all duration-300 border border-gray-200/50 dark:border-dark-700/50;
  }

  /* Gradient text utility */
  .gradient-text {
    @apply bg-gradient-to-r from-primary-600 to-primary-500 bg-clip-text text-transparent;
  }

  .dark .gradient-text {
    @apply from-primary-400 to-primary-300;
  }

  /* Loading animation */
  @keyframes pulse-slow {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  .pulse-slow {
    animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  /* Modern glass effect */
  .glass {
    @apply bg-white/10 dark:bg-white/5 backdrop-blur-lg border border-white/20 dark:border-white/10;
  }
}

@layer utilities {
  /* Text selection styles */
  ::selection {
    @apply bg-primary-200 dark:bg-primary-800 text-primary-900 dark:text-primary-100;
  }

  /* Animation utilities */
  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%,
    100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  /* Backdrop utilities */
  .backdrop-blur-xs {
    backdrop-filter: blur(2px);
  }
}

/* Enable view transitions for cross-document navigation */
@view-transition {
  navigation: auto;
}

/* Simple crossfade for the entire page */
::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 0.15s;
  animation-timing-function: ease-out;
}

/* Sidebar stays stable during transitions */
#sidebar {
  view-transition-name: sidebar;
}

::view-transition-old(sidebar),
::view-transition-new(sidebar) {
  animation: none;
}

/* Header stays stable during transitions */
header {
  view-transition-name: header;
}

::view-transition-old(header),
::view-transition-new(header) {
  animation: none;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.01ms !important;
  }
}
